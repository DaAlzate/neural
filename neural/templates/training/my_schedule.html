{% extends 'base.html' %}


{% block content %}

<div class="page-content">
    <div class="container-fluid">
        <div class="col-xl-6 offset-lg-3">
            <a href="{% url 'users:index' %}">Regresar</a>
            <div class="card mt-2">
                <div class="card-body">
                 
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-5 text-center">Esta semana vamos con toda!!</h4>
                                    <div class="">
                                        <ul class="verti-timeline list-unstyled">
                                            
                                            {% for event in user_slots  %}
                                            <li class="event-list ">
                                                <div class="event-timeline-dot">
                                                    <i class="bx bx-right-arrow-circle"></i>
                                                </div>
                                                <div class="media">
                                                    <div class="mr-3">
                                                        <i class="bx {{event.random_icon}} h2 text-primary"></i>
                                                    </div>
                                                    <div class="media-body">
                                                        <div>
                                                            <h5>Entrenamiento: {{event.slot.get_training_type_display}}</h5>
                                                            <p class="text-muted">
                                                                
                                                                
                                                                    
                                                                {% if event.is_now %}<span class="badge badge-pill badge-success float-left mr-1">HOY </span>{% endif %} {{event.slot.date}} de {{event.slot.hour_init}} a {{event.slot.hour_end}}.</p>
                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                            {% endfor %}

                                        
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block js %}
<script>
    date = document.getElementById('id_fecha')
    select = document.getElementById('id_slot')

    date.onchange = function () {
        value = date.value
        $.ajax({
            type: 'POST',
            url: "{% url 'training:api-training-get-slots' %}",
            data: {
                "date": value,
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'user': '{{request.user.email}}'
            },
            timeout: 5000,
            dataType: "json",
        })
        .done(function (response) {
            result = response.result
            if (result) {
                
                select.disabled = false;
                for (i = 0, len = result.length; i < len; i++) {
                    slot = result[i];
                    var opt = document.createElement('option');
                    opt.value = slot.id;
                    opt.innerHTML = slot.hour_init + ' a ' + slot.hour_end;
                    select.appendChild(opt);
                  } 
              }
        })
        .fail(function (response) {
            select.disabled = true;
            Swal.fire(
                'Uy... no hay clases disponibles para esta fecha',
                '<p>Intenta buscar en otra fecha.</p>',
                'error'
            )
        })
    };
</script>
{% endblock js %}